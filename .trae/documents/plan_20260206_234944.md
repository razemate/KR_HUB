Based on your updated requirements, I have refined the plan to build a "Simple, Professional, World-Class" AI Hub.

### **Core Objectives**
1.  **Dual-Provider Strategy**: 
    *   **Primary**: Google Gemini (via `google-generativeai` lib).
    *   **Fallback**: OpenRouter Free Tier (via `openai` SDK with `openrouter/free` model) if Gemini fails.
2.  **Rich Chat UI**: 
    *   Support **Markdown** rendering (tables, lists, code blocks).
    *   Support **File Uploads** (CSV/PDF) for data analysis.
    *   Support **Charts** (visualizing data returned from the backend).
3.  **Data Querying**: The app will query the connected Supabase database to answer questions.

### **Implementation Steps**

#### **1. Backend (FastAPI + AI Gateway)**
*   **Refactor `ai_gateway.py`**:
    *   Implement a `try-except` block: Attempt Gemini first. If it fails (e.g., quota, error), catch the exception and immediately retry with OpenRouter.
    *   Configure OpenRouter to use `"openrouter/free"` with reasoning enabled.
*   **Enhance `chat_with_data.py`**:
    *   Add a **File Upload Endpoint**: Parse uploaded files (CSV text or PDF text) and inject their content into the AI context window.
    *   Ensure the "Text-to-SQL" feature uses this robust gateway.

#### **2. Frontend (React + Vite)**
*   **Upgrade `Chat.jsx`**:
    *   Install `react-markdown` and `recharts` for rendering rich content.
    *   Add a **File Input** button (paperclip icon) to the chat bar.
    *   Implement `onFileUpload` logic to send files to the backend *before* or *with* the message.
    *   Render tables and charts if the AI returns structured data (JSON/Markdown).

#### **3. Verification & Speed**
*   I will test the fallback mechanism by simulating a Gemini error.
*   I will verify table rendering by asking "Show me the profiles data in a table".
*   I will ensure the app opens immediately after these updates.

This plan focuses on **simplicity** (no over-engineering) and **robustness** (fallback logic).
